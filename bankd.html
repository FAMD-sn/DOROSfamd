
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DOROSBANK PREMIUM ¬∑ –•—É–¥–∂–∞–Ω–¥ —Å–∏—Ç–∏</title>
  <!-- Material Icons + Google Fonts -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400&display=swap" rel="stylesheet">
  <!-- QR Code –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Firebase SDK 8.10.0 (–ø–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <style>
    /* ===== –£–õ–¨–¢–†–ê-–ü–†–ï–ú–ò–ê–õ–¨–ù–´–ô –î–ò–ó–ê–ô–ù 4K ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    :root {
      --primary: #0f2b4b;
      --primary-light: #1e3a6f;
      --accent: #00c2a5;
      --accent-glow: #64ffda;
      --dark-bg: #0a1120;
      --card-bg: #14253d;
      --surface: #1f3147;
      --text-primary: #ffffff;
      --text-secondary: #b0c4de;
      --text-muted: #6b8cae;
      --danger: #ff5e7d;
      --success: #2ecc71;
      --warning: #f39c12;
      --gold: #f1c40f;
      --platinum: #a5b8d3;
      --radius-sm: 16px;
      --radius-md: 24px;
      --radius-lg: 36px;
      --radius-xl: 48px;
      --shadow-card: 0 20px 40px -15px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
      --shadow-glow: 0 0 30px rgba(0,194,165,0.3);
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      background: var(--dark-bg);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
      font-weight: 400;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 70% 30%, rgba(0,194,165,0.08), transparent 70%);
      z-index: -1;
      pointer-events: none;
    }

    /* –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    .hidden { display: none !important; }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .container {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 32px;
    }

    /* ===== –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ===== */
    #auth-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at 20% 30%, #1a2f48, #0a111f);
      padding: 24px;
    }

    .auth-card {
      background: rgba(20, 37, 61, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-xl);
      padding: 56px 48px;
      width: 100%;
      max-width: 520px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: var(--shadow-card), 0 0 0 1px rgba(0,194,165,0.2);
      animation: fadeInUp 0.6s ease;
    }

    .auth-logo {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-bottom: 48px;
    }

    .auth-logo .logo-icon {
      font-size: 56px;
      color: var(--accent);
      filter: drop-shadow(0 0 15px var(--accent-glow));
    }

    .auth-logo span {
      font-size: 40px;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #ffffff, var(--accent-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .auth-tabs {
      display: flex;
      gap: 12px;
      background: rgba(10, 17, 32, 0.6);
      padding: 8px;
      border-radius: 80px;
      margin-bottom: 40px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .auth-tab {
      flex: 1;
      padding: 16px 24px;
      text-align: center;
      font-weight: 600;
      font-size: 18px;
      border-radius: 60px;
      cursor: pointer;
      color: var(--text-muted);
      transition: var(--transition);
      letter-spacing: 0.3px;
    }

    .auth-tab.active {
      background: var(--accent);
      color: #0a1120;
      box-shadow: 0 8px 20px rgba(0,194,165,0.4);
    }

    .auth-input {
      width: 100%;
      padding: 20px 28px;
      background: rgba(10, 17, 32, 0.7);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 60px;
      font-size: 18px;
      color: white;
      margin-bottom: 24px;
      transition: var(--transition);
    }

    .auth-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(0,194,165,0.2);
    }

    .auth-input::placeholder {
      color: var(--text-muted);
      font-weight: 300;
    }

    .auth-btn {
      width: 100%;
      padding: 20px 28px;
      background: linear-gradient(135deg, var(--accent), #009b84);
      border: none;
      border-radius: 60px;
      font-weight: 700;
      font-size: 20px;
      color: #0a1120;
      margin: 16px 0 24px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 12px 30px -8px rgba(0,194,165,0.5);
    }

    .auth-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 40px -8px var(--accent);
    }

    /* ===== –•–ï–î–ï–† ===== */
    .app-header {
      background: rgba(20, 37, 61, 0.8);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      padding: 20px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo .material-icons {
      font-size: 36px;
      color: var(--accent);
    }

    .logo span {
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(135deg, #fff, var(--accent-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 28px;
    }

    .user-name {
      font-weight: 500;
      font-size: 18px;
      color: var(--text-secondary);
    }

    .admin-badge {
      background: linear-gradient(135deg, var(--gold), #d4af37);
      color: #0a1120;
      padding: 6px 20px;
      border-radius: 60px;
      font-size: 14px;
      font-weight: 800;
      letter-spacing: 0.5px;
    }

    .logout-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      padding: 12px 28px;
      border-radius: 60px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 16px;
      font-weight: 500;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.15);
      border-color: var(--accent);
    }

    /* ===== –û–°–ù–û–í–ù–û–ô –õ–ï–ô–ê–£–¢ ===== */
    .app-wrapper {
      display: flex;
      gap: 32px;
      padding: 40px 0;
    }

    /* –°–∞–π–¥–±–∞—Ä */
    .sidebar {
      width: 300px;
      flex-shrink: 0;
    }

    .nav-menu {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 28px 12px;
      position: sticky;
      top: 120px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow-card);
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 24px;
      margin: 4px 0;
      border-radius: 60px;
      color: var(--text-muted);
      transition: var(--transition);
      cursor: pointer;
      font-size: 18px;
      font-weight: 500;
    }

    .nav-item .material-icons {
      font-size: 28px;
    }

    .nav-item:hover {
      background: rgba(255,255,255,0.05);
      color: white;
    }

    .nav-item.active {
      background: linear-gradient(90deg, var(--accent), transparent);
      color: white;
      box-shadow: 0 8px 20px rgba(0,194,165,0.3);
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    .main-content {
      flex: 1;
      min-width: 0;
    }

    /* –í–∏–¥–∂–µ—Ç –±–∞–ª–∞–Ω—Å–∞ */
    .balance-widget {
      background: linear-gradient(145deg, var(--card-bg), #0e1c2f);
      border-radius: var(--radius-xl);
      padding: 36px 40px;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow-card);
    }

    .balance-info h3 {
      color: var(--text-muted);
      font-weight: 400;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }

    .balance-amount {
      font-size: 64px;
      font-weight: 700;
      color: white;
      line-height: 1.1;
      text-shadow: 0 5px 20px rgba(0,194,165,0.4);
    }

    .active-card-badge {
      background: var(--accent);
      color: #0a1120;
      padding: 6px 18px;
      border-radius: 60px;
      font-size: 14px;
      font-weight: 700;
      margin-left: 20px;
    }

    .balance-actions {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .btn-round {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: white;
      padding: 16px 32px;
      border-radius: 60px;
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: blur(5px);
    }

    .btn-round.primary {
      background: var(--accent);
      color: #0a1120;
      border: none;
      box-shadow: 0 10px 25px rgba(0,194,165,0.4);
    }

    .btn-round:hover {
      background: rgba(255,255,255,0.15);
      transform: translateY(-2px);
    }

    .btn-round.primary:hover {
      background: #00b39b;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
    .card-preview {
      background: linear-gradient(135deg, #1d3557, #0f2b4b);
      border-radius: var(--radius-xl);
      padding: 28px 36px;
      margin-bottom: 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 30px 50px -20px black, 0 0 0 1px rgba(0,194,165,0.3);
      position: relative;
      overflow: hidden;
    }

    .card-preview::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(255,255,255,0.1), transparent 70%);
      border-radius: 50%;
      pointer-events: none;
    }

    .card-preview-left {
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 2;
    }

    .card-type {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .card-number {
      font-family: 'Courier New', monospace;
      font-size: 28px;
      font-weight: 600;
      letter-spacing: 4px;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .card-holder {
      font-size: 18px;
      color: rgba(255,255,255,0.8);
      text-transform: uppercase;
    }

    .card-expiry {
      color: rgba(255,255,255,0.7);
      font-size: 20px;
      font-weight: 500;
      z-index: 2;
    }

    /* –°–µ—Ç–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
    .quick-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px;
      margin-bottom: 48px;
    }

    .quick-item {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 28px 16px;
      text-align: center;
      transition: var(--transition);
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow-card);
    }

    .quick-item:hover {
      transform: translateY(-8px);
      background: #1f3a5f;
      border-color: var(--accent);
    }

    .quick-item .material-icons {
      font-size: 48px;
      color: var(--accent);
      margin-bottom: 16px;
    }

    .quick-item span:last-child {
      font-size: 18px;
      font-weight: 600;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ */
    .section-card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 36px;
      margin-bottom: 32px;
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: var(--shadow-card);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
    }

    .section-header h2 {
      font-size: 28px;
      font-weight: 600;
      background: linear-gradient(135deg, #fff, var(--accent-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç */
    #cards-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      margin: 24px 0;
    }

    .card-item-preview {
      background: linear-gradient(145deg, #1d2b42, #0e1a2b);
      border-radius: var(--radius-lg);
      padding: 28px;
      border: 1px solid rgba(255,255,255,0.05);
      transition: var(--transition);
      cursor: pointer;
    }

    .card-item-preview:hover {
      border-color: var(--accent);
      transform: scale(1.02);
    }

    /* –ú–∞–≥–∞–∑–∏–Ω –∫–∞—Ä—Ç */
    .shop-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
    }

    .shop-item {
      background: rgba(10, 17, 32, 0.7);
      backdrop-filter: blur(10px);
      border-radius: var(--radius-xl);
      padding: 36px 24px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.05);
      transition: var(--transition);
    }

    .shop-item:hover {
      transform: translateY(-10px);
      border-color: var(--accent);
      box-shadow: var(--shadow-glow);
    }

    .shop-item .material-icons {
      font-size: 72px;
      color: var(--accent);
    }

    .shop-item h4 {
      font-size: 28px;
      margin: 16px 0;
    }

    .card-price {
      font-size: 36px;
      font-weight: 800;
      color: var(--accent);
      margin: 20px 0;
    }

    .btn-shop {
      background: transparent;
      border: 2px solid var(--accent);
      color: white;
      padding: 16px 32px;
      border-radius: 60px;
      font-weight: 700;
      font-size: 18px;
      width: 100%;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-shop:hover {
      background: var(--accent);
      color: #0a1120;
    }

    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(15px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 24px;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 48px;
      width: 100%;
      max-width: 600px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: var(--shadow-card), 0 0 0 1px var(--accent);
      animation: modalPop 0.3s ease;
    }

    @keyframes modalPop {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .modal-header h3 {
      font-size: 32px;
      font-weight: 700;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 40px;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--danger);
    }

    .form-group {
      margin-bottom: 28px;
    }

    .form-group label {
      display: block;
      margin-bottom: 12px;
      color: var(--text-secondary);
      font-size: 18px;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 18px 28px;
      background: rgba(10, 17, 32, 0.8);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 60px;
      color: white;
      font-size: 18px;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--accent);
    }

    .alert {
      padding: 18px 24px;
      border-radius: 60px;
      margin: 24px 0;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 16px;
      font-weight: 500;
    }

    .alert-success {
      background: rgba(46, 204, 113, 0.15);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .alert-danger {
      background: rgba(255, 94, 125, 0.15);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .modal-footer {
      display: flex;
      gap: 20px;
      justify-content: flex-end;
      margin-top: 32px;
    }

    /* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ */
    .transaction {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .transaction-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .transaction-date {
      font-size: 14px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .transaction-description {
      font-size: 18px;
      font-weight: 600;
    }

    .transaction-amount {
      font-size: 22px;
      font-weight: 700;
    }

    .positive { color: var(--success); }
    .negative { color: var(--danger); }

    /* QR –±–ª–æ–∫ */
    .qr-panel {
      text-align: center;
      padding: 32px;
    }

    #qrcode-display canvas {
      border-radius: 32px;
      background: white;
      padding: 16px;
      margin: 24px auto;
      box-shadow: 0 20px 40px black;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 1200px) {
      .quick-grid { grid-template-columns: repeat(2, 1fr); }
      .shop-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 900px) {
      .app-wrapper { flex-direction: column; }
      .sidebar { width: 100%; }
      .nav-menu { display: flex; flex-wrap: wrap; gap: 8px; }
      .nav-item { flex: 1; justify-content: center; }
      .balance-amount { font-size: 48px; }
    }

    @media (max-width: 600px) {
      .auth-card { padding: 36px 24px; }
      .auth-logo span { font-size: 32px; }
      .balance-widget { flex-direction: column; align-items: flex-start; gap: 24px; }
    }
  </style>
</head>
<body>

<!-- ========== –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ========== -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="auth-logo">
      <span class="material-icons logo-icon">account_balance</span>
      <span>DOROSBANK</span>
    </div>
    <div class="auth-tabs">
      <div class="auth-tab active" id="tab-login">–í—Ö–æ–¥</div>
      <div class="auth-tab" id="tab-reg">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
    </div>
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div id="login-form">
      <input type="email" id="login-email" class="auth-input" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞">
      <input type="password" id="login-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
      <button id="login-btn" class="auth-btn"><span class="material-icons">login</span> –í–æ–π—Ç–∏</button>
      <p style="text-align:center; color:var(--text-muted);">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="show-register" style="color:var(--accent); font-weight:600;">–°–æ–∑–¥–∞—Ç—å</a></p>
    </div>
    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Å–∫—Ä—ã—Ç–∞) -->
    <div id="register-form" style="display:none;">
      <input type="text" id="register-fullname" class="auth-input" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è (–∫–∞–∫ –≤ –ø–∞—Å–ø–æ—Ä—Ç–µ)">
      <input type="tel" id="register-phone" class="auth-input" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
      <input type="email" id="register-email" class="auth-input" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞">
      <input type="password" id="register-password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)">
      <button id="register-btn" class="auth-btn"><span class="material-icons">person_add</span> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      <p style="text-align:center; color:var(--text-muted);">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="show-login" style="color:var(--accent); font-weight:600;">–í–æ–π—Ç–∏</a></p>
    </div>
    <div id="auth-message" class="alert hidden"></div>
  </div>
</div>

<!-- ========== –û–°–ù–û–í–ù–û–ô –ë–ê–ù–ö–û–í–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–° ========== -->
<div id="bank-screen" class="hidden">
  <header class="app-header">
    <div class="container header-row">
      <div class="logo">
        <span class="material-icons">account_balance</span>
        <span>DOROSBANK</span>
      </div>
      <div class="user-menu">
        <span class="user-name" id="user-display-name"></span>
        <span id="admin-badge" class="admin-badge hidden">–ê–î–ú–ò–ù</span>
        <button id="logout-btn" class="logout-btn"><span class="material-icons">logout</span> –í—ã–π—Ç–∏</button>
      </div>
    </div>
  </header>

  <div class="container app-wrapper">
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <aside class="sidebar">
      <div class="nav-menu">
        <div class="nav-item active" data-tab="dashboard"><span class="material-icons">space_dashboard</span> –ì–ª–∞–≤–Ω–∞—è</div>
        <div class="nav-item" data-tab="my-cards"><span class="material-icons">credit_card</span> –ú–æ–∏ –∫–∞—Ä—Ç—ã</div>
        <div class="nav-item" data-tab="buy-cards"><span class="material-icons">shopping_bag</span> –ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –∫–∞—Ä—Ç—É</div>
        <div class="nav-item" data-tab="qr-generator"><span class="material-icons">qr_code_2</span> –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR</div>
        <div class="nav-item" data-tab="analytics"><span class="material-icons">analytics</span> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
      </div>
    </aside>

    <main class="main-content">
      <!-- ===== DASHBOARD ===== -->
      <div id="dashboard-tab" class="tab-content">
        <!-- –ë–∞–ª–∞–Ω—Å + –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="balance-widget">
          <div class="balance-info">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å</h3>
            <div class="balance-amount" id="balance">0 TJS</div>
            <span id="active-card-badge" class="active-card-badge">–û—Å–Ω–æ–≤–Ω–∞—è</span>
          </div>
          <div class="balance-actions">
            <button class="btn-round primary" onclick="openModal('deposit-modal')"><span class="material-icons">add</span> –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            <button class="btn-round" onclick="openModal('transfer-modal')"><span class="material-icons">send</span> –ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
            <button class="btn-round" onclick="showMyQR()"><span class="material-icons">qr_code</span> QR</button>
          </div>
        </div>

        <!-- –ê–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ (–ø—Ä–µ–≤—å—é) -->
        <div class="card-preview" id="active-card-display">
          <div class="card-preview-left">
            <span class="card-type" id="active-card-type-label">–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞</span>
            <span class="card-number" id="active-card-number">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
            <span class="card-holder" id="active-card-name">–í–õ–ê–î–ï–õ–ï–¶ –ö–ê–†–¢–´</span>
          </div>
          <div class="card-expiry" id="active-card-expiry">‚àû/‚àû</div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–∏–∫–æ–Ω–∫–∏) -->
        <div class="quick-grid">
          <div class="quick-item" onclick="openModal('deposit-modal')"><span class="material-icons">account_balance_wallet</span><span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span></div>
          <div class="quick-item" onclick="openModal('transfer-modal')"><span class="material-icons">swap_horiz</span><span>–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</span></div>
          <div class="quick-item" onclick="showMyQR()"><span class="material-icons">qr_code_scanner</span><span>–ú–æ–π QR</span></div>
          <div class="quick-item" onclick="showAllTransactions()"><span class="material-icons">history</span><span>–ò—Å—Ç–æ—Ä–∏—è</span></div>
        </div>

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div class="section-card">
          <div class="section-header">
            <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
            <button id="view-all-btn" class="btn-round" style="padding:12px 28px;"><span class="material-icons">list</span> –í—Å—è –∏—Å—Ç–æ—Ä–∏—è</button>
          </div>
          <div id="recent-transactions"></div>
        </div>
      </div>

      <!-- ===== –ú–û–ò –ö–ê–†–¢–´ ===== -->
      <div id="my-cards-tab" class="tab-content hidden">
        <div class="section-card">
          <div class="section-header"><h2>–ú–æ–∏ –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –∫–∞—Ä—Ç—ã</h2></div>
          <div id="cards-list" class="cards-grid"></div>
          <button id="add-card-btn" class="btn-round primary" style="margin-top: 24px;"><span class="material-icons">add</span> –í—ã–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É</button>
        </div>
      </div>

      <!-- ===== –ü–†–ò–û–ë–†–ï–°–¢–ò –ö–ê–†–¢–£ ===== -->
      <div id="buy-cards-tab" class="tab-content hidden">
        <div class="section-card">
          <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h2>
          <div class="shop-grid" id="shop-cards-container">
            <!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ js -->
          </div>
        </div>
      </div>

      <!-- ===== –ì–ï–ù–ï–†–ê–¢–û–† QR ===== -->
      <div id="qr-generator-tab" class="tab-content hidden">
        <div class="section-card">
          <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä QR-–∫–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</h2>
          <div style="max-width:500px; margin: 32px auto;">
            <div class="form-group">
              <label>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É</label>
              <select id="qr-card-select" class="form-control"></select>
            </div>
            <div class="form-group">
              <label>–°—É–º–º–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
              <input type="number" id="qr-amount" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 500">
            </div>
            <button id="generate-qr-btn" class="btn-round primary" style="width:100%;"><span class="material-icons">qr_code_2</span> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <div id="qr-code-result" style="display:none; margin-top:32px; text-align:center;">
              <div id="qrcode-display"></div>
              <div id="qr-display-card-number" style="margin-top:20px; font-size:20px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== –ê–ù–ê–õ–ò–¢–ò–ö–ê ===== -->
      <div id="analytics-tab" class="tab-content hidden">
        <div class="section-card">
          <h2>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-top:32px;">
            <div style="background:#0f1a2b; border-radius:36px; padding:28px;">
              <span class="material-icons" style="font-size:48px; color:var(--accent);">trending_up</span>
              <div style="font-size:22px; margin:16px 0;">–û–±—â–∏–π –¥–æ—Ö–æ–¥</div>
              <div style="font-size:36px; font-weight:700;" id="total-income">0 TJS</div>
            </div>
            <div style="background:#0f1a2b; border-radius:36px; padding:28px;">
              <span class="material-icons" style="font-size:48px; color:var(--danger);">trending_down</span>
              <div style="font-size:22px; margin:16px 0;">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</div>
              <div style="font-size:36px; font-weight:700;" id="total-expense">0 TJS</div>
            </div>
          </div>
          <div style="margin-top:32px;">
            <h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: <span id="tx-count">0</span></h3>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== -->
<!-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ -->
<div id="deposit-modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header"><h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3><button class="modal-close">&times;</button></div>
    <div class="modal-body">
      <div class="form-group"><label>–°—É–º–º–∞ (TJS)</label><input type="number" id="deposit-amount" class="form-control" placeholder="100"></div>
      <div class="form-group"><label>PIN –∫–∞—Ä—Ç—ã</label><input type="password" id="deposit-pin" class="form-control" maxlength="4" placeholder="****"></div>
      <div id="deposit-message" class="alert hidden"></div>
    </div>
    <div class="modal-footer"><button class="btn-round close-modal">–û—Ç–º–µ–Ω–∞</button><button id="confirm-deposit" class="btn-round primary">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button></div>
  </div>
</div>

<!-- –ü–µ—Ä–µ–≤–æ–¥ -->
<div id="transfer-modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header"><h3>–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3><button class="modal-close">&times;</button></div>
    <div class="modal-body">
      <div class="form-group"><label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label><input type="text" id="recipient-card" class="form-control" placeholder="0000 0000 0000 0000"></div>
      <div class="form-group"><label>–°—É–º–º–∞</label><input type="number" id="transfer-amount" class="form-control" placeholder="500"></div>
      <div class="form-group"><label>–í–∞—à PIN</label><input type="password" id="transfer-pin" class="form-control" maxlength="4" placeholder="****"></div>
      <div class="form-group"><label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label><input type="text" id="transfer-comment" class="form-control" placeholder="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ"></div>
      <div id="transfer-message" class="alert hidden"></div>
    </div>
    <div class="modal-footer"><button class="btn-round close-modal">–û—Ç–º–µ–Ω–∞</button><button id="confirm-transfer" class="btn-round primary">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button></div>
  </div>
</div>

<!-- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É -->
<div id="add-card-modal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header"><h3>–í—ã–ø—É—Å–∫ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã</h3><button class="modal-close">&times;</button></div>
    <div class="modal-body">
      <div class="form-group"><label>–¢–∏–ø –∫–∞—Ä—Ç—ã</label>
        <select id="new-card-type" class="form-control">
          <option value="debit">–î–µ–±–µ—Ç–æ–≤–∞—è (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</option>
          <option value="gold">Gold (500 TJS)</option>
          <option value="platinum">Platinum (1000 TJS)</option>
        </select>
      </div>
      <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã</label><input type="text" id="new-card-name" class="form-control" placeholder="–ú–æ—è –ø—Ä–µ–º–∏—É–º –∫–∞—Ä—Ç–∞"></div>
      <div id="add-card-message" class="alert hidden"></div>
    </div>
    <div class="modal-footer"><button class="btn-round close-modal">–û—Ç–º–µ–Ω–∞</button><button id="confirm-add-card" class="btn-round primary">–í—ã–ø—É—Å—Ç–∏—Ç—å</button></div>
  </div>
</div>

<!-- QR-–º–æ–¥–∞–ª–∫–∞ –ø–æ–∫–∞–∑–∞ -->
<div id="qr-modal" class="modal hidden">
  <div class="modal-content" style="max-width: 500px; text-align:center;">
    <div class="modal-header"><h3>–í–∞—à QR-–∫–æ–¥</h3><button class="modal-close">&times;</button></div>
    <div id="qrcode-modal" style="margin:20px 0;"></div>
    <div id="qr-modal-card-number" style="font-size:20px; margin-bottom:20px;"></div>
  </div>
</div>

<!-- ========== –°–ö–†–ò–ü–¢ ========== -->
<script>
  (function() {
    // ==================== FIREBASE INIT ====================
    const firebaseConfig = {
      apiKey: "AIzaSyB7DP0EZfTQE78CUj8N-_aPyfEf5MvAc5g",
      authDomain: "doroscoin.firebaseapp.com",
      databaseURL: "https://doroscoin-default-rtdb.firebaseio.com",
      projectId: "doroscoin",
      storageBucket: "doroscoin.appspot.com",
      messagingSenderId: "372256789289",
      appId: "1:372256789289:web:48d518bd16c0c5fa6e5d38"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const storage = firebase.storage();

    // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
    let currentUser = null;
    let userData = null;
    let userCards = [];
    let activeCardIndex = 0;
    const ADMIN_EMAIL = "doros@bank.tj";

    // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ====================
    function formatAmount(amount) {
      return new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'TJS', minimumFractionDigits: 0 }).format(amount || 0);
    }

    function generateCardNumber() {
      let num = '';
      for (let i = 0; i < 16; i++) {
        num += Math.floor(Math.random() * 10);
        if ((i + 1) % 4 === 0 && i < 15) num += ' ';
      }
      return num;
    }

    function showMessage(element, text, isSuccess) {
      element.textContent = text;
      element.className = `alert ${isSuccess ? 'alert-success' : 'alert-danger'}`;
      element.classList.remove('hidden');
      if (isSuccess) setTimeout(() => element.classList.add('hidden'), 3000);
    }

    window.openModal = function(id) {
      document.getElementById(id).classList.remove('hidden');
    };

    function closeAllModals() {
      document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
    }

    // ==================== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ====================
    function loadUserData(uid) {
      database.ref(`users/${uid}`).once('value').then(snap => {
        userData = snap.val() || {};
        if (!userData.cards || userData.cards.length === 0) {
          const firstCard = {
            id: 'card_' + Date.now(),
            type: 'debit',
            number: generateCardNumber(),
            name: '–û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–∞',
            balance: 1500,  // –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å
            isPrimary: true,
            pin: '1234',
            expiry: '12/28'
          };
          userData.cards = [firstCard];
          userData.transactions = userData.transactions || [];
          userData.credits = userData.credits || [];
          database.ref(`users/${uid}`).set(userData);
        }
        userCards = userData.cards || [];
        activeCardIndex = userCards.findIndex(c => c.isPrimary) || 0;
        if (activeCardIndex === -1 && userCards.length) activeCardIndex = 0;
        updateUI();
      });
    }

    // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
    function updateUI() {
      document.getElementById('user-display-name').textContent = userData?.fullName || (currentUser?.email || '');
      document.getElementById('admin-badge').classList.toggle('hidden', currentUser?.email !== ADMIN_EMAIL);

      if (userCards.length) {
        const card = userCards[activeCardIndex] || userCards[0];
        document.getElementById('active-card-type-label').textContent = 
          card.type === 'gold' ? 'Gold Card' : (card.type === 'platinum' ? 'Platinum Card' : '–î–µ–±–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞');
        document.getElementById('active-card-number').textContent = card.number;
        document.getElementById('active-card-name').textContent = (card.name || '–í–ª–∞–¥–µ–ª–µ—Ü').toUpperCase();
        document.getElementById('active-card-expiry').textContent = card.expiry;
        document.getElementById('balance').textContent = formatAmount(card.balance);
      }

      // –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç
      const cardsContainer = document.getElementById('cards-list');
      if (cardsContainer) {
        if (!userCards.length) cardsContainer.innerHTML = '<div>–ù–µ—Ç –∫–∞—Ä—Ç</div>';
        else {
          cardsContainer.innerHTML = userCards.map((c, i) => `
            <div class="card-item-preview" onclick="setActiveCard(${i})">
              ${c.isPrimary ? '<span style="background:var(--accent);color:black;padding:4px 12px;border-radius:60px;">–û—Å–Ω–æ–≤–Ω–∞—è</span>' : ''}
              <div style="font-size:22px; font-weight:600; margin:12px 0;">${c.name}</div>
              <div style="font-family:monospace; font-size:18px;">${c.number}</div>
              <div style="font-size:26px; font-weight:700; margin-top:16px;">${formatAmount(c.balance)}</div>
            </div>
          `).join('');
        }
      }

      // –°–µ–ª–µ–∫—Ç –¥–ª—è QR
      const qrSelect = document.getElementById('qr-card-select');
      if (qrSelect) {
        qrSelect.innerHTML = userCards.map((c,i) => `<option value="${i}">${c.name} ‚Äî ${c.number}</option>`).join('');
      }

      // –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
      const tx = (userData.transactions || []).slice(0, 7);
      const recentDiv = document.getElementById('recent-transactions');
      if (!tx.length) recentDiv.innerHTML = '<div style="text-align:center; padding:48px;">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>';
      else {
        recentDiv.innerHTML = tx.map(t => `
          <div class="transaction">
            <div class="transaction-info">
              <div class="transaction-date"><span class="material-icons">schedule</span>${new Date(t.timestamp).toLocaleString()}</div>
              <div class="transaction-description">${t.type === 'deposit' ? '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : t.type === 'transfer_out' ? '–ü–µ—Ä–µ–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω' : '–ü–µ—Ä–µ–≤–æ–¥ –ø–æ–ª—É—á–µ–Ω'}</div>
            </div>
            <div class="transaction-amount ${t.type === 'deposit' || t.type === 'transfer_in' ? 'positive' : 'negative'}">
              ${t.type === 'deposit' || t.type === 'transfer_in' ? '+' : '-'}${formatAmount(t.amount)}
            </div>
          </div>
        `).join('');
      }

      // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
      if (userData.transactions) {
        let income = 0, expense = 0;
        userData.transactions.forEach(t => {
          if (t.type === 'deposit' || t.type === 'transfer_in') income += t.amount;
          else if (t.type === 'transfer_out' || t.type === 'purchase') expense += t.amount;
        });
        document.getElementById('total-income').textContent = formatAmount(income);
        document.getElementById('total-expense').textContent = formatAmount(expense);
        document.getElementById('tx-count').textContent = userData.transactions.length;
      }
    }

    window.setActiveCard = function(index) {
      if (index >= 0 && index < userCards.length) {
        activeCardIndex = index;
        updateUI();
      }
    };

    // ==================== –ü–û–ö–ê–ó QR ====================
    window.showMyQR = function() {
      if (!userCards.length) { alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ä—Ç'); return; }
      const card = userCards[activeCardIndex] || userCards[0];
      const link = window.location.origin + window.location.pathname + `?card=${card.number.replace(/\s/g, '')}`;
      const container = document.getElementById('qrcode-modal');
      container.innerHTML = '';
      new QRCode(container, { text: link, width: 250, height: 250 });
      document.getElementById('qr-modal-card-number').textContent = card.number;
      document.getElementById('qr-modal').classList.remove('hidden');
    };

    window.showAllTransactions = function() {
      const tx = userData.transactions || [];
      if (!tx.length) { alert('–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞'); return; }
      let msg = '–ò–°–¢–û–†–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô\n\n';
      tx.slice(0, 20).forEach(t => {
        msg += `${t.type === 'deposit' ? '‚ûï' : t.type === 'transfer_out' ? '‚ûñ' : 'üîπ'} ${formatAmount(t.amount)} ‚Äî ${new Date(t.timestamp).toLocaleString()}\n`;
      });
      alert(msg);
    };

    // ==================== –ü–û–ü–û–õ–ù–ï–ù–ò–ï ====================
    document.getElementById('confirm-deposit')?.addEventListener('click', function() {
      const amount = parseFloat(document.getElementById('deposit-amount').value);
      const pin = document.getElementById('deposit-pin').value;
      const msg = document.getElementById('deposit-message');
      if (!amount || amount <= 0) { showMessage(msg, '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', false); return; }
      const card = userCards[activeCardIndex];
      if (!card) return;
      if (pin !== card.pin) { showMessage(msg, '–ù–µ–≤–µ—Ä–Ω—ã–π PIN', false); return; }

      card.balance += amount;
      const tx = { id: Date.now(), type: 'deposit', amount, timestamp: new Date().toISOString() };
      if (!userData.transactions) userData.transactions = [];
      userData.transactions.unshift(tx);
      database.ref(`users/${currentUser.uid}`).set(userData).then(() => {
        showMessage(msg, `–ü–æ–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ ${formatAmount(amount)}`, true);
        setTimeout(closeAllModals, 1500);
        updateUI();
      });
    });

    // ==================== –ü–ï–†–ï–í–û–î ====================
    document.getElementById('confirm-transfer')?.addEventListener('click', function() {
      const toCardRaw = document.getElementById('recipient-card').value.replace(/\s/g, '');
      const amount = parseFloat(document.getElementById('transfer-amount').value);
      const pin = document.getElementById('transfer-pin').value;
      const comment = document.getElementById('transfer-comment').value;
      const msg = document.getElementById('transfer-message');
      if (!toCardRaw || toCardRaw.length !== 16) { showMessage(msg, '–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã', false); return; }
      if (!amount || amount <= 0) { showMessage(msg, '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É', false); return; }
      const card = userCards[activeCardIndex];
      if (pin !== card.pin) { showMessage(msg, '–ù–µ–≤–µ—Ä–Ω—ã–π PIN', false); return; }
      const fee = amount * 0.01;
      const total = amount + fee;
      if (total > card.balance) { showMessage(msg, '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ (–≤–∫–ª—é—á–∞—è –∫–æ–º–∏—Å—Å–∏—é 1%)', false); return; }

      database.ref('users').once('value').then(snap => {
        let recipientUid = null, recipientCard = null, recipientData = null;
        snap.forEach(child => {
          const u = child.val();
          if (u.cards) {
            const found = u.cards.find(c => c.number.replace(/\s/g, '') === toCardRaw);
            if (found) { recipientUid = child.key; recipientCard = found; recipientData = u; }
          }
        });
        if (!recipientUid) { showMessage(msg, '–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', false); return; }
        if (recipientUid === currentUser.uid) { showMessage(msg, '–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–∞–º–æ–º—É —Å–µ–±–µ', false); return; }

        card.balance -= total;
        recipientCard.balance = (recipientCard.balance || 0) + amount;

        const outTx = { id: Date.now(), type: 'transfer_out', amount, to: toCardRaw, fee, comment, timestamp: new Date().toISOString() };
        const inTx = { id: Date.now()+1, type: 'transfer_in', amount, from: card.number, comment, timestamp: new Date().toISOString() };
        if (!userData.transactions) userData.transactions = [];
        if (!recipientData.transactions) recipientData.transactions = [];
        userData.transactions.unshift(outTx);
        recipientData.transactions.unshift(inTx);

        const updates = {};
        updates[`users/${currentUser.uid}`] = userData;
        updates[`users/${recipientUid}`] = recipientData;
        database.ref().update(updates).then(() => {
          showMessage(msg, `–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–æ ${formatAmount(amount)} (–∫–æ–º–∏—Å—Å–∏—è ${formatAmount(fee)})`, true);
          setTimeout(closeAllModals, 2000);
          updateUI();
        });
      });
    });

    // ==================== –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–ê–†–¢–´ ====================
    document.getElementById('confirm-add-card')?.addEventListener('click', function() {
      const type = document.getElementById('new-card-type').value;
      const name = document.getElementById('new-card-name').value.trim() || (type==='gold'?'Gold':type==='platinum'?'Platinum':'–î–µ–±–µ—Ç–æ–≤–∞—è');
      const price = type==='gold'?500: type==='platinum'?1000:0;
      const msg = document.getElementById('add-card-message');
      const activeCard = userCards[activeCardIndex];
      if (price > 0 && price > activeCard.balance) { showMessage(msg, `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ù—É–∂–Ω–æ ${price} TJS.`, false); return; }
      if (price > 0) activeCard.balance -= price;

      const newCard = {
        id: 'card_'+Date.now(),
        type,
        number: generateCardNumber(),
        name,
        balance: 0,
        isPrimary: false,
        pin: '1234',
        expiry: '12/28'
      };
      userCards.push(newCard);
      if (price > 0) {
        if (!userData.transactions) userData.transactions = [];
        userData.transactions.unshift({ id: Date.now(), type: 'purchase', amount: price, item: type+' card', timestamp: new Date().toISOString() });
      }
      database.ref(`users/${currentUser.uid}`).set(userData).then(() => {
        showMessage(msg, '–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø—É—â–µ–Ω–∞', true);
        setTimeout(() => { closeAllModals(); updateUI(); }, 1500);
      });
    });

    // ==================== QR-–ì–ï–ù–ï–†–ê–¢–û–† ====================
    document.getElementById('generate-qr-btn')?.addEventListener('click', function() {
      const idx = parseInt(document.getElementById('qr-card-select').value);
      const card = userCards[idx];
      if (!card) return;
      let link = window.location.origin + window.location.pathname + `?card=${card.number.replace(/\s/g, '')}`;
      const amount = document.getElementById('qr-amount').value;
      if (amount) link += `&amount=${amount}`;
      const container = document.getElementById('qrcode-display');
      container.innerHTML = '';
      new QRCode(container, { text: link, width: 250, height: 250 });
      document.getElementById('qr-display-card-number').textContent = card.number;
      document.getElementById('qr-code-result').style.display = 'block';
    });

    // ==================== –ú–ê–ì–ê–ó–ò–ù –ö–ê–†–¢ ====================
    const shopContainer = document.getElementById('shop-cards-container');
    if (shopContainer) {
      shopContainer.innerHTML = `
        <div class="shop-item"><span class="material-icons">credit_card</span><h4>–î–µ–±–µ—Ç–æ–≤–∞—è</h4><div class="card-price">0 TJS</div><button class="btn-shop" onclick="quickPurchase('debit')">–ü–æ–ª—É—á–∏—Ç—å</button></div>
        <div class="shop-item"><span class="material-icons">star</span><h4>Gold</h4><div class="card-price">500 TJS</div><button class="btn-shop" onclick="quickPurchase('gold')">–ö—É–ø–∏—Ç—å</button></div>
        <div class="shop-item"><span class="material-icons">diamond</span><h4>Platinum</h4><div class="card-price">1000 TJS</div><button class="btn-shop" onclick="quickPurchase('platinum')">–ö—É–ø–∏—Ç—å</button></div>
      `;
    }

    window.quickPurchase = function(type) {
      document.getElementById('new-card-type').value = type;
      document.getElementById('new-card-name').value = type === 'gold' ? 'Gold Card' : type === 'platinum' ? 'Platinum Card' : 'Debit Card';
      openModal('add-card-modal');
    };

    // ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –¢–ê–ë–û–í ====================
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', function() {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        this.classList.add('active');
        const tabId = this.dataset.tab;
        document.getElementById(tabId + '-tab').classList.remove('hidden');
      });
    });

    // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
    document.getElementById('login-btn').addEventListener('click', () => {
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-password').value;
      auth.signInWithEmailAndPassword(email, pass).catch(e => showMessage(document.getElementById('auth-message'), e.message, false));
    });

    document.getElementById('register-btn').addEventListener('click', () => {
      const name = document.getElementById('register-fullname').value;
      const phone = document.getElementById('register-phone').value;
      const email = document.getElementById('register-email').value;
      const pass = document.getElementById('register-password').value;
      if (!name || !phone || !email || pass.length < 6) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, –ø–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
      auth.createUserWithEmailAndPassword(email, pass).then(cred => {
        const uid = cred.user.uid;
        const userRecord = { fullName: name, phone, email, cards: [], transactions: [], credits: [] };
        database.ref(`users/${uid}`).set(userRecord).then(() => loadUserData(uid));
      }).catch(e => showMessage(document.getElementById('auth-message'), e.message, false));
    });

    // ==================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –§–û–†–ú ====================
    document.getElementById('show-register')?.addEventListener('click', (e) => {
      e.preventDefault(); 
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-reg').classList.add('active');
    });
    document.getElementById('show-login')?.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-login').classList.add('active');
    });
    document.getElementById('tab-login').addEventListener('click', () => {
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-login').classList.add('active');
    });
    document.getElementById('tab-reg').addEventListener('click', () => {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('tab-reg').classList.add('active');
    });

    document.getElementById('add-card-btn')?.addEventListener('click', () => openModal('add-card-modal'));
    document.getElementById('logout-btn')?.addEventListener('click', () => auth.signOut());
    document.getElementById('view-all-btn')?.addEventListener('click', showAllTransactions);

    document.querySelectorAll('.modal-close, .close-modal').forEach(b => b.addEventListener('click', closeAllModals));

    // ==================== –°–õ–£–®–ê–¢–ï–õ–¨ –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ====================
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('bank-screen').classList.remove('hidden');
        loadUserData(user.uid);
      } else {
        currentUser = null;
        document.getElementById('auth-screen').classList.remove('hidden');
        document.getElementById('bank-screen').classList.add('hidden');
        closeAllModals();
      }
    });
  })();
</script>

</body>
</html>
